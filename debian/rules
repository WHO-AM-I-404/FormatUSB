#!/usr/bin/make -f
# Debhelper compatibility level
export DH_COMPAT=13

QMAKE_OPTS = DEFINES+=NO_DEBUG_ON_CONSOLE
MAKE_OPTS  = QMAKE=qmake6 QMAKE_OPTS="$(QMAKE_OPTS)"

# ----------------------------------------
# Configure step
# ----------------------------------------
override_dh_auto_configure:
	qmake6

# ----------------------------------------
# Clean step
# ----------------------------------------
override_dh_auto_clean:
	dh_auto_clean
	rm -f translations/*.qm

# ----------------------------------------
# Build step
# ----------------------------------------
override_dh_auto_build:
	# Compile translations
	/usr/lib/qt6/bin/lrelease translations/*.ts
	# Generate version header
	head -n1 debian/changelog | sed -e "s/.*(\([^(]*\)).*/#define VERSION \"\1\"/" > version.h
	dh_auto_build -- $(MAKE_OPTS)

# ----------------------------------------
# Install step
# ----------------------------------------
override_dh_auto_install:
	dh_auto_install -- $(MAKE_OPTS)

# ----------------------------------------
# Build deb package
# ----------------------------------------
override_dh_builddeb:
	dh_builddeb -- -Z xz

# ----------------------------------------
# Shlib dependencies
# ----------------------------------------
override_dh_shlibdeps:
	dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info

# Default target
%:
	dh $@ --no-automatic-dbgsym
